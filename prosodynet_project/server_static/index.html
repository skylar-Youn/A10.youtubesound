<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ProsodyNet Emotion TTS</title>
    <link rel="stylesheet" href="/static/styles.css">
</head>
<body>
    <main class="container">
        <header>
            <h1>ProsodyNet 감정 음성 합성</h1>
            <p>문장을 입력하고 감정을 선택하면 ProsodyNet이 TTS 음성을 감정화합니다.</p>
        </header>

        <section class="card">
            <form id="synth-form">
                <label class="field">
                    <span>합성할 문장</span>
                    <textarea id="text-input" rows="4" placeholder="예: 안녕하세요, 오늘 기분이 어떤가요?" required></textarea>
                </label>

                <fieldset class="field">
                    <legend>
                        <label class="inline">
                            <input id="use-prosodynet" type="checkbox" checked>
                            ProsodyNet 감정 변환 사용
                        </label>
                    </legend>
                    <div id="prosodynet-config">
                        <div class="help-block">
                            <p><strong>ESD 데이터셋 기반 학습</strong></p>
                            <ul>
                                <li>화자: 20명 (English 10명 + Mandarin 10명)</li>
                                <li>감정: 5개 (Neutral, Happy, Sad, Angry, Surprise)</li>
                                <li>각 감정당 7,000개 음성 파일</li>
                                <li>총 35,000개 병렬 발화 데이터</li>
                            </ul>
                            <p><strong>시스템 정보</strong></p>
                            <ul>
                                <li>CPU: <span id="cpu-info">로딩 중...</span></li>
                                <li>처리 방식: 16코어 병렬 처리로 전처리 수행</li>
                            </ul>
                        </div>
                        <label class="field">
                            <span>화자 선택 (Speaker)</span>
                            <select id="speaker-select">
                                <option value="0001">0001 - English Speaker 1</option>
                                <option value="0002">0002 - English Speaker 2</option>
                                <option value="0003">0003 - English Speaker 3</option>
                                <option value="0004">0004 - English Speaker 4</option>
                                <option value="0005">0005 - English Speaker 5</option>
                                <option value="0006">0006 - English Speaker 6</option>
                                <option value="0007">0007 - English Speaker 7</option>
                                <option value="0008">0008 - English Speaker 8</option>
                                <option value="0009">0009 - English Speaker 9</option>
                                <option value="0010">0010 - English Speaker 10</option>
                                <option value="0011">0011 - Mandarin Speaker 1</option>
                                <option value="0012">0012 - Mandarin Speaker 2</option>
                                <option value="0013">0013 - Mandarin Speaker 3</option>
                                <option value="0014">0014 - Mandarin Speaker 4</option>
                                <option value="0015">0015 - Mandarin Speaker 5</option>
                                <option value="0016">0016 - Mandarin Speaker 6</option>
                                <option value="0017">0017 - Mandarin Speaker 7</option>
                                <option value="0018">0018 - Mandarin Speaker 8</option>
                                <option value="0019">0019 - Mandarin Speaker 9</option>
                                <option value="0020">0020 - Mandarin Speaker 10</option>
                            </select>
                        </label>
                        <label class="field">
                            <span>감정</span>
                            <select id="emotion-select">
                                <option value="0">0 - Neutral (중립)</option>
                                <option value="1">1 - Happy (기쁨)</option>
                                <option value="2">2 - Sad (슬픔)</option>
                                <option value="3">3 - Angry (화남)</option>
                                <option value="4">4 - Surprise (놀람)</option>
                            </select>
                        </label>
                    </div>
                </fieldset>

                <fieldset class="field">
                    <legend>TTS 엔진</legend>
                    <label class="inline">
                        <input type="radio" name="tts-engine" value="coqui" checked>
                        Coqui TTS
                    </label>
                    <label class="inline">
                        <input type="radio" name="tts-engine" value="orpheus">
                        Orpheus TTS
                    </label>

                    <div id="coqui-config" class="field">
                        <label class="field">
                            <span>TTS 모델 ID</span>
                            <input id="tts-model" type="text" value="tts_models/multilingual/multi-dataset/xtts_v2">
                        </label>
                    </div>

                    <div id="orpheus-config" class="field hidden">
                        <label class="field">
                            <span>Orpheus Voice</span>
                            <select id="orpheus-voice">
                                <option value="tara">Tara</option>
                                <option value="leah">Leah</option>
                                <option value="jess">Jess</option>
                                <option value="leo">Leo</option>
                                <option value="dan">Dan</option>
                                <option value="mia">Mia</option>
                                <option value="zac">Zac</option>
                                <option value="zoe">Zoe</option>
                            </select>
                        </label>
                    </div>
                </fieldset>

                <fieldset class="field" id="vocoder-section">
                    <legend>Vocoder (ProsodyNet용)</legend>
                    <label class="inline">
                        <input type="radio" name="vocoder-mode" value="griffinlim" checked>
                        Griffin-Lim
                    </label>
                    <label class="inline">
                        <input type="radio" name="vocoder-mode" value="hifigan">
                        HiFi-GAN
                    </label>

                    <div id="hifigan-config" class="grid hidden">
                        <label class="field">
                            <span>Generator 모듈 (예: vocoder.hifigan_generator)</span>
                            <input id="hifigan-module" type="text" placeholder="선택">
                        </label>
                        <label class="field">
                            <span>Generator 체크포인트 경로</span>
                            <input id="hifigan-ckpt" type="text" placeholder="선택">
                        </label>
                        <label class="field">
                            <span>Config JSON 경로</span>
                            <input id="hifigan-config-path" type="text" placeholder="선택">
                        </label>
                    </div>
                </fieldset>

                <fieldset class="field">
                    <legend>
                        <label class="inline">
                            <input id="use-rvc" type="checkbox">
                            RVC 후처리 사용
                        </label>
                    </legend>
                    <div id="rvc-config" class="grid hidden">
                        <div class="help-block">
                            <p>ProsodyNet이 생성한 감정 음성을 RVC로 변환하려면 아래 항목을 모두 채워야 합니다.</p>
                            <p>RVC CLI는 `python infer-web.py`처럼 직접 실행할 명령이며, 서버는 자동으로 `--input_path`, `--output_path`, `--pth_path`, `--config_path`, `--f0method`, `--pitch_shift` 인자를 뒤에 붙입니다.</p>
                            <p>목록에서 선택한 `.pth`/설정 파일이 상대경로라면 위의 RVC 기본 경로와 합쳐져 전달됩니다.</p>
                        </div>
                        <label class="field">
                            <span>RVC 기본 경로</span>
                            <div class="row">
                                <input id="rvc-base" type="text" value="/home/sk/ws/SD/RVC_TRAIN/Mangio-RVC-v23.7.0/weights" placeholder="예: /home/.../weights">
                                <button id="rvc-refresh" type="button" class="secondary-button">목록 불러오기</button>
                            </div>
                        </label>
                        <label class="field">
                            <span>RVC CLI (예: python infer-web.py)</span>
                            <input id="rvc-cli" type="text" value="python infer-web.py" placeholder="선택">
                        </label>
                        <label class="field">
                            <span>RVC 모델 (.pth)</span>
                            <input id="rvc-pth" type="text" value="logs/mi-test7/G_2333333.pth" placeholder="선택 또는 직접 입력" list="rvc-pth-options">
                            <datalist id="rvc-pth-options"></datalist>
                        </label>
                        <label class="field">
                            <span>RVC Config 경로</span>
                            <input id="rvc-config-path" type="text" value="logs/mi-test7/config.json" placeholder="선택 또는 직접 입력" list="rvc-config-options">
                            <datalist id="rvc-config-options"></datalist>
                        </label>
                    </div>
                </fieldset>

                <button id="synth-btn" type="submit">합성 실행</button>
            </form>
            <div id="status" class="status">준비 완료</div>
        </section>

        <section id="results" class="card hidden">
            <h2>결과</h2>
            <ul>
                <li><span>중립 음성:</span> <audio id="neutral-audio" controls></audio></li>
                <li><span>감정 멜 스펙트로그램:</span> <a id="mel-link" href="#" download>다운로드</a></li>
                <li><span>감정 음성:</span> <audio id="emotional-audio" controls></audio></li>
                <li id="ckpt-line"></li>
            </ul>
        </section>
    </main>

    <script src="/static/app.js" type="module"></script>
</body>
</html>
